{:version=>3, :sections=>[{:offset=>{:line=>0, :column=>0}, :map=>{:version=>3, :sourceRoot=>"", :sources=>["bcdice/game_system/CastleInGray.rb"], :sourcesContent=>["# frozen_string_literal: true\n\nmodule BCDice\n  module GameSystem\n    class CastleInGray < Base\n      # ゲームシステムの識別子\n      ID = \"CastleInGray\"\n\n      # ゲームシステム名\n      NAME = \"灰色城綺譚\"\n\n      # ゲームシステム名の読みがな\n      SORT_KEY = \"はいいろしようきたん\"\n\n      HELP_MESSAGE = <<~TEXT\n        ■ 色占い (BnWm)\n        n: 黒\n        m: 白\n        n, m は1～12の異なる整数\n\n        例) B12W7\n        例) B5W12\n\n        ■ 悪意の渦による占い (MALn)\n        n: 悪意の渦\n        n は1～12の整数\n\n        ■ その他\n        ・感情表 ET\n        ・暗示表(黒) BIT\n        ・暗示表(白) WIT\n      TEXT\n\n      TABLES = {\n        \"ET\" => DiceTable::Table.new(\n          \"感情表\",\n          \"1D12\",\n          [\n            \"友情(白)／敵視(黒)\",\n            \"恋慕(白)／嫌悪(黒)\",\n            \"信頼(白)／不信(黒)\",\n            \"同情(白)／憐憫(黒)\",\n            \"憧憬(白)／劣等感(黒)\",\n            \"尊敬(白)／蔑視(黒)\",\n            \"忠誠(白)／執着(黒)\",\n            \"有用(白)／邪魔(黒)\",\n            \"許容(白)／罪悪感(黒)\",\n            \"羨望(白)／嫉妬(黒)\",\n            \"共感(白)／拒絶(黒)\",\n            \"愛情(白)／狂信(黒)\"\n          ]\n        ),\n        \"BIT\" => DiceTable::Table.new(\n          \"暗示表(黒)\",\n          \"1D12\",\n          [\n            \"終わりなき夜に生まれつく者もあり\",\n            \"悪意もて真実を語らば\",\n            \"笑えども笑みはなし\",\n            \"影より抜け出ることあたわじ\",\n            \"心の赴くままに手をとれ\",\n            \"時ならぬ嵐の過ぎ去るを待つ\",\n            \"赦されぬと知るがゆえに\",\n            \"見張りは持ち場を離れる\",\n            \"誰もが盲いたる彷徨い人なり\",\n            \"落ちる日を眺めるがごとく\",\n            \"冷たく雨ぞ降りしきる\",\n            \"今日は笑む花も明日には枯れゆく\"\n          ]\n        ),\n        \"WIT\" => DiceTable::Table.new(\n          \"暗示表(白)\",\n          \"1D12\",\n          [\n            \"無垢なる者のみが真実を得る\",\n            \"げに慈悲深きは沈黙なり\",\n            \"懐かしき日々は去りぬ\",\n            \"束の間に光さす\",\n            \"迷える者に手を差し伸べよ\",\n            \"嵐の前には静けさがある\",\n            \"どうか責めないで\",\n            \"灯した明かりを絶やさぬように\",\n            \"目を開けて見よ\",\n            \"淑やかに訪れる\",\n            \"今こそ泣け、さもなくば二度と泣くな\",\n            \"時が許す間に薔薇を摘め\"\n          ]\n        ),\n      }.freeze\n\n      register_prefix('B', 'MAL', TABLES.keys)\n\n      def eval_game_system_specific_command(command)\n        return roll_color(command) || roll_mal(command) || roll_tables(command, TABLES)\n      end\n\n      def roll_color(command)\n        m = /^B(\\d{1,2})W(\\d{1,2})$/.match(command)\n        return nil unless m\n\n        black = m[1].to_i\n        white = m[2].to_i\n        return nil unless black.between?(1, 12) && white.between?(1, 12)\n\n        value = @randomizer.roll_once(12)\n\n        if black == white\n          return color_text(black, white, value, '白と黒は重ねられません')\n        end\n\n        if white > black\n          return color_text(black, white, value, black <= value && value < white ? '黒' : '白')\n        else\n          return color_text(black, white, value, white <= value && value < black ? '白' : '黒')\n        end\n      end\n\n      def color_text(black, white, value, result)\n        return \"色占い(黒\#{black}白\#{white}) ＞ [\#{value}] ＞ \#{result}\"\n      end\n\n      def roll_mal(command)\n        m = /^MAL(\\d{1,2})$/i.match(command)\n        return nil unless m\n\n        mal = m[1].to_i\n        return nil unless mal.between?(1, 12)\n\n        value = @randomizer.roll_once(12)\n        result = value <= mal ? '黒' : '白'\n        return \"悪意の渦(\#{mal}) ＞ [\#{value}] ＞ \#{result}\"\n      end\n    end\n  end\nend\n"], :names=>["<main>", "<module:BCDice>", "<module:GameSystem>", "<class:CastleInGray>", "DiceTable::Table", "DiceTable", "new", "freeze", "self", "register_prefix", "TABLES", "keys", "eval_game_system_specific_command", "command", "$ret_or_1", "$ret_or_2", "roll_color", "roll_mal", "roll_tables", "m", "match", "black", "[]", "1", "to_i", "white", "2", "between?", "12", "value", "@randomizer", "roll_once", "color_text", ">", "<=", "<", "result", "mal", "Base"], :mappings=>"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"}}]}