{:version=>3, :sections=>[{:offset=>{:line=>0, :column=>0}, :map=>{:version=>3, :sourceRoot=>"", :sources=>["bcdice/game_system/PhantasmAdventure.rb"], :sourcesContent=>["# frozen_string_literal: true\n\nmodule BCDice\n  module GameSystem\n    class PhantasmAdventure < Base\n      # ゲームシステムの識別子\n      ID = 'PhantasmAdventure'\n\n      # ゲームシステム名\n      NAME = 'ファンタズム・アドベンチャー'\n\n      # ゲームシステム名の読みがな\n      SORT_KEY = 'ふあんたすむあとへんちやあ'\n\n      # ダイスボットの使い方\n      HELP_MESSAGE = <<~INFO_MESSAGE_TEXT\n        成功、失敗、決定的成功、決定的失敗の表示とクリティカル・ファンブル値計算の実装。\n      INFO_MESSAGE_TEXT\n\n      # ゲーム別成功度判定(1d20)\n      def result_1d20(total, _dice_total, cmp_op, diff)\n        return Result.nothing if diff == '?'\n        return nil unless cmp_op == :<=\n\n        # 技能値の修正を計算する\n        skill_mod = 0\n        if diff < 1\n          skill_mod = diff - 1\n        elsif diff > 20\n          skill_mod = diff - 20\n        end\n\n        fumble = 20 + skill_mod\n        fumble = 20 if fumble > 20\n        critical = 1 + skill_mod\n        dice_now = @randomizer.roll_once(20)\n\n        if (total >= fumble) || (total >= 20)\n          fum_num = dice_now - skill_mod\n          fum_num = 20 if fum_num > 20\n          fum_num = 1 if fum_num < 1\n\n          fum_str = dice_now.to_s\n          if skill_mod < 0\n            fum_str += \"+\#{skill_mod * -1}=\#{fum_num}\"\n          else\n            fum_str += \"-\#{skill_mod}=\#{fum_num}\"\n          end\n          return Result.fumble(\"致命的失敗(\#{fum_str})\")\n\n        elsif (total <= critical) || (total <= 1)\n          crit_num = dice_now + skill_mod\n          crit_num = 20 if crit_num > 20\n          crit_num = 1 if crit_num < 1\n\n          if skill_mod < 0\n            return Result.success(\"成功\")\n          end\n\n          return Result.critical(\"決定的成功(\#{dice_now}+\#{skill_mod}=\#{crit_num})\")\n        elsif total <= diff\n          return Result.success(\"成功\")\n        else\n          return Result.failure(\"失敗\")\n        end\n      end\n    end\n  end\nend\n"], :names=>["<main>", "<module:BCDice>", "<module:GameSystem>", "<class:PhantasmAdventure>", "result_1d20", "total", "_dice_total", "cmp_op", "diff", "Result", "nothing", "skill_mod", "0", "<", "1", "-", ">", "20", "fumble", "+", "critical", "dice_now", "@randomizer", "roll_once", ">=", "fum_num", "fum_str", "to_s", "*", "-1", "<=", "crit_num", "success", "failure", "Base"], :mappings=>"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"}}]}