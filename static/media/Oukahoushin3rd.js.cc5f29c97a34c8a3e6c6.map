{:version=>3, :sections=>[{:offset=>{:line=>0, :column=>0}, :map=>{:version=>3, :sourceRoot=>"", :sources=>["bcdice/game_system/Oukahoushin3rd.rb"], :sourcesContent=>["# frozen_string_literal: true\n\nmodule BCDice\n  module GameSystem\n    class Oukahoushin3rd < Base\n      # ゲームシステムの識別子\n      ID = 'Oukahoushin3rd'\n\n      # ゲームシステム名\n      NAME = '央華封神RPG 第三版'\n\n      # ゲームシステム名の読みがな\n      SORT_KEY = 'おうかほうしんRPG3'\n\n      # ダイスボットの使い方\n      HELP_MESSAGE = <<~INFO_MESSAGE_TEXT\n        ・各種表\n        　・能力値判定裏成功表（NHT）\n        　・武器攻撃裏成功表（BKT）\n        　・受け・回避裏成功表（UKT）\n        　・仙術行使裏成功表（SKT）\n        　・仙術抵抗裏成功表（STT）\n        　・精神値ダメージ悪影響表（SDT）\n        　・狂気表（KKT）\n      INFO_MESSAGE_TEXT\n\n      def eval_game_system_specific_command(command)\n        chosen = roll_tables(command, TABLES)\n        return replace_dice_notation(chosen)\n      end\n\n      private\n\n      def replace_dice_notation(text)\n        text&.gsub(/(\\d+)D(\\d+)/) do |matched|\n          times, sides = matched.split(\"D\").map(&:to_i)\n          value = @randomizer.roll_sum(times, sides)\n          \"\#{matched}(=>\#{value})\"\n        end\n      end\n\n      TABLES = {\n        \"BKT\" => DiceTable::Table.new(\n          \"武器攻撃裏成功表\",\n          \"2D6\",\n          [\n            \"1ポイント清徳値が低下。連続攻撃が行える。この場合の連続攻撃においては、命中判定のサイコロは常にひっくり返して用いるが、2撃目以降はこの表は使わない。\",\n            \"敵に叩きつけると同時に武器が破損。素手や身体に備わった武器（爪、牙など）で攻撃をしていた場合には、自身にも1D6（のみ）ダメージ。\",\n            \"効果的命中。ダメージに1D6加算。ただし極度に疲労するため、精神値に1D6点ダメージを受ける。（2ゾロ）1ポイント仙骨が上昇、体力または機敏（攻撃を行った者が選択する）が1ポイント低下。\",\n            \"ふつうの命中。\",\n            \"不完全な命中、ダメージは半分。（3ゾロ）1ポイント仙骨が低下。\",\n            \"ふつうの命中。\",\n            \"体力または機敏（攻撃を行った者が選択する）が1D6日間、1ポイント上昇。（4ゾロ）能力値の上昇は永遠。\",\n            \"ふつうの命中。\",\n            \"体力または機敏（攻撃を行った者が選択する）が1D6日間、1ポイント低下。（5ゾロ）能力値の低下は永遠。\",\n            \"呼吸を乱す、数瞬間（1D6ラウンド）は仙術を使用できない。\",\n            \"1ポイント清徳値が低下。体力または機敏（攻撃を行った者が選択する）が1ポイント上昇。\"\n          ]\n        ),\n        \"KKT\" => DiceTable::Table.new(\n          \"狂気表\",\n          \"2D6\",\n          [\n            \"心神喪失、生ける屍。\",\n            \"被害妄想。仲間も含め、他者は全て自分を傷つけようとしていると思いこむ。行動はゲームマスターが管理。\",\n            \"重度の不安症。失敗を恐れるあまり、次ラウンドは行動不可。それ以降も、2ラウンドに1回しか行動できない（自動武器や使役獣への命令なども）。\\\\n「次のラウンドに行動できない」状態では、「割り込み」は行えない。\",\n            \"重度の依存症。自分で行動を決められず、仲間に決めてもらわなければならない。\",\n            \"二重人格。二つ目の人格は狂気。新たに狂気表（KKT）で決定（再度二重人格が出た場合は、振りなおす）。狂気表を使った直後は、この二つ目の人格。\\\\n1日以上、二重人格が持続している場合、その間に精神値ダメージを受けるたびに、その直後に1Dを振らねばならない。1が出たらこの狂気が顔を出す。\\\\n二つ目の人格が顔を出している時間は、1Dで決定する（1～3：短時間、4～5：半日、6：1日）。\",\n            \"軽度の依存症。仲間の承認がなければ、思いついた行動を実行できない。\",\n            \"軽度の偏執狂。ある行為や物品などに異常な執着を示す。ただし、行動に大きな影響は与えない。具体的な内容は、ゲームマスターとプレイヤーの相談で決定。\",\n            \"重度の偏執狂。行動に重大な影響を与える。具体的内容は、ゲームマスターが決定。\",\n            \"恐怖症。あるものに対して恐怖。対象からは、ひたすら逃亡しようとする。また、対象に遭遇するたびに、難易度10で意志の能力値判定を行わねばならず、失敗したら1Dの精神値ダメージを受ける。恐怖の対象は、ゲームマスターが決定。\",\n            \"狂暴化。仲間も含め、他者はすべて敵とみなし、傷つけようとする。行動はゲームマスターが管理。\",\n            \"錯乱。行動はゲームマスターが「なるべくでたらめになるように」決定する。\"\n          ]\n        ),\n        \"NHT\" => DiceTable::Table.new(\n          \"能力値判定裏成功表\",\n          \"2D6\",\n          [\n            \"1ポイント清徳値が低下。変な癖が身についてしまう。\",\n            \"やりすぎ。過剰な成功をしたり、よけいなことまでして災いが起こりうる。\",\n            \"「気」の爆発。大成功。ただし極度に疲労するため、精神値に1D6点ダメージを受ける。（2ゾロ）1ポイント仙骨が上昇、使用した能力値が1ポイント低下。\",\n            \"ふつうの成功。\",\n            \"不完全な成功、数値的効果は半分ほどに見積もる。（3ゾロ）1ポイント仙骨が低下。\",\n            \"ふつうの成功。\",\n            \"使用した能力値が1D6日間、1ポイント上昇。（4ゾロ）能力値の上昇は永遠。\",\n            \"ふつうの成功。\",\n            \"使用した能力値が1D6日間、1ポイント低下。（5ゾロ）能力値の低下は永遠。\",\n            \"呼吸を乱す、数瞬間（1D6ラウンド）は仙術を使用できない。\",\n            \"1ポイント清徳値が低下。使用した能力値が1ポイント上昇。\"\n          ]\n        ),\n        \"SDT\" => DiceTable::Table.new(\n          \"精神値ダメージ悪影響表\",\n          \"1D6\",\n          [\n            \"一瞬の放心。直後の判定は自動的に失敗。精神値を1D6×最大値の10％回復。\",\n            \"一瞬の放心。直後の判定は自動的に失敗。精神値を1D6×最大値の10％回復。\",\n            \"一瞬の放心。直後の判定は自動的に失敗。精神値を1D6×最大値の10％回復。\",\n            \"放心状態。強制され、自動失敗するまで、自発的行動不可。精神値を（1D6+2）×最大値の10％回復。\",\n            \"精神異常（具体的内容は狂気表（KKT）で決定）。短時間のみ。精神値を（1D6+4）×最大値の10％回復。\",\n            \"精神異常（具体的内容は狂気表（KKT）で決定）。期間は1D6を振って決定（1～3：1日、4～5：99日間、6：永遠）。精神値を最大値まで回復。\"\n          ]\n        ),\n        \"SKT\" => DiceTable::Table.new(\n          \"仙術行使裏成功表\",\n          \"2D6\",\n          [\n            \"1ポイント清徳値が低下。1ポイント仙骨が上昇。\",\n            \"術の効果は術者にも解除不能になる。精神値に1点ダメージを受ける。\",\n            \"「気」の暴走。効果3倍。ただし極度に疲労するため、精神値に1D6点ダメージを受ける。（2ゾロ）術者は1D6日間、仙術が使用不能になる。1ポイント仙骨が上昇。\",\n            \"術が敵にかけたものの場合、仲間の1人を巻きこむ。精神値に1点ダメージを受ける。\",\n            \"不完全な成功、効果半分。（3ゾロ）持続時間のある術の場合、術者がひたすら精神集中していない限り、術はすぐに解除される。\",\n            \"ふつうの成功。\",\n            \"1ポイント清徳値が低下。（4ゾロ）仙骨以外のいずれかの能力値（術者選択）が1D6日間、1ポイント上昇。\",\n            \"術が味方もしくは自分にかけたものの場合、敵の1人にも同じようにかかる。精神値に1点ダメージを受ける。\",\n            \"仙骨以外のいずれかの能力値（術者選択）が1D6日間、1ポイント低下。（5ゾロ）能力値の低下は永遠。\",\n            \"1D3ポイント清徳値が低下。\",\n            \"1D6ポイント清徳値が低下。仙骨以外のいずれかの能力値（術者選択）が1ポイント上昇。\"\n          ]\n        ),\n        \"STT\" => DiceTable::Table.new(\n          \"仙術抵抗裏成功表\",\n          \"2D6\",\n          [\n            \"1ポイント清徳値が低下。\",\n            \"そらされた術の効果が味方に及ぶ。味方の誰にそらされたかは、この表を使ったものが選ぶ。集団攻撃仙術の場合、抵抗に成功したものの中から選ぶこと。ほかの誰も成功に抵抗していなかったときは、ふつうの抵抗成功として扱う。精神値に1点ダメージを受ける。\",\n            \"仙術をかけた敵にその効果が及ぼされる。敵自身はそれに対して、抵抗を試みることができる。（2ゾロ）1ポイント仙骨が上昇。1ポイント知覚が低下。\",\n            \"ふつうの抵抗成功。\",\n            \"不完全な抵抗、ふつうの半分の効果を受ける。（3ゾロ）1ポイント仙骨が低下。\",\n            \"ふつうの抵抗成功。\",\n            \"仙骨または知覚（仙術に抵抗した者が選択する）が1D6日間、1ポイント上昇。（4ゾロ）能力値の上昇は永遠。\",\n            \"ふつうの抵抗成功。\",\n            \"仙骨または知覚（仙術に抵抗した者が選択する）が1D6日間、1ポイント低下。（5ゾロ）能力値の低下は永遠。\",\n            \"呼吸を乱す、数瞬間（1D6ラウンド）は仙術を使用できない。\",\n            \"1ポイント清徳値が低下。仙骨または知覚（仙術に抵抗した者が選択する）が1ポイント上昇。\"\n          ]\n        ),\n        \"UKT\" => DiceTable::Table.new(\n          \"受け・回避裏成功表\",\n          \"2D6\",\n          [\n            \"1ポイント清徳値が低下。\",\n            \"転倒する（空を飛んでいるものは落下。乗騎などに乗っていたら転落）。精神値に1点ダメージを受ける。\",\n            \"相手のバランスを崩すのに成功。攻撃を行った敵が転倒（空を飛んでいるものは落下。乗騎などに乗っていたら転落）。（2ゾロ）1ポイント仙骨が上昇、機敏または知覚（攻撃を防御した者が選択する）が1ポイント低下。\",\n            \"ふつうの防御成功。\",\n            \"不完全な防御、通常の半分のダメージを受ける。しかし敵が連続攻撃を行うことは出来ない。攻撃者が裏成功攻撃であってもその反動は決めない。（3ゾロ）1ポイント仙骨が低下。\",\n            \"ふつうの防御成功。\",\n            \"機敏または知覚（攻撃を防御した者が選択する）が1D6日間、1ポイント上昇。（4ゾロ）能力値の上昇は永遠。\",\n            \"ふつうの防御成功。\",\n            \"機敏または知覚（攻撃を防御した者が選択する）が1D6日間、1ポイント低下。（5ゾロ）能力値の低下は永遠。\",\n            \"呼吸を乱す、数瞬間（1D6ラウンド）は仙術を使用できない。\",\n            \"1ポイント清徳値が低下。機敏または知覚（攻撃を防御した者が選択する）が1ポイント上昇。\"\n          ]\n        ),\n      }.freeze\n\n      register_prefix(TABLES.keys)\n    end\n  end\nend\n"], :names=>["<main>", "<module:BCDice>", "<module:GameSystem>", "<class:Oukahoushin3rd>", "eval_game_system_specific_command", "command", "chosen", "self", "roll_tables", "TABLES", "replace_dice_notation", "private", "text", "block in replace_dice_notation", "matched", "block (2 levels) in replace_dice_notation", "map", "split", "to_proc", "times", "sides", "value", "@randomizer", "roll_sum", "DiceTable::Table", "DiceTable", "new", "freeze", "register_prefix", "keys", "Base"], :mappings=>"AAAAA,2BAAAA;EAAAA;;EAEAA,OAAAC;EAAAA;;IAAAA;;IACEA,OAAAC;IAAAA;;MAAAA;;MACEA,OAAAC;MAAAA;;QAAAA;;;QAEE,8BAAKA,gBAAL;QAGA,gCAAOA,aAAP;QAGA,oCAAWA,aAAX;QAGA,wCACNA,QADqB,GAErBA,oBAFqB,GAGrBA,mBAHqB,GAIrBA,oBAJqB,GAKrBA,mBALqB,GAMrBA,mBANqB,GAOrBA,sBAPqB,GAQrBA,cARM;;AAWAC,QAAAA,iDAAAA,6CAAsCC,OAAtCD;AAAAA,UAAAA;;;UACEE,SAASC,IAAAC,aAAAA,CAAYH,OAAZ,EAAqBI,YAArBD;UACT,OAAOD,IAAAG,uBAAAA,CAAsBJ,MAAtBI;QAFTN,CAAAA;QAKAG,IAAAI,SAAAA,CAAAA;;AAEAD,QAAAA,qCAAAA,iCAA0BE,IAA1BF;AAAAA,UAAAA;;UACEA,OAAA,CAAA,KAAAE,IAAA,qCAAA,MAAA,EAAA,QAAA,EAAA,CAAW,aAAX,CAAA,EAAAC,aAA8BC,OAA9BD,EAAAE;AAAAA;;;YAA8B;YAC5B,KAAiCC,MAAlBF,OAAOG,OAAAA,CAAOF,GAAPE,CAAWD,OAAAA,EAAAA,EAAAA,EAAM,MAADE,SAAAA,CAAAA,CAALF,CAAjC,kBAAA,EAAAG,CAAAA,QAAA,6BAAAA,CAAA,EAAOC,CAAAA,QAAP,6BAAOA,CAAP;YACAC,QAAQC,eAAWC,UAAAA,CAAUJ,KAArB,EAA4BC,KAAjBG;YACnBR,OAAA,EAAA,GAAA,CAAGD,OAAH,CAAA,GAAWC,KAAX,GAAA,CAAgBM,KAAhB,CAAA,GAAsBN,IAHxBF,CAAAA,GAAAA,SAAAA,CAAA,CAAA;QADFH,CAAAA;QAQA,kCAAS,2DAAA,OACEc,IAAAC,eAAAD,UAAgBE,KAAAA,CACvBvB,UADO,EAEPA,KAFO,EAGP,CACEA,6EADF,EAEEA,mEAFF,EAGEA,+FAHF,EAIEA,SAJF,EAKEA,iCALF,EAMEA,SANF,EAOEA,qDAPF,EAQEA,SARF,EASEA,qDATF,EAUEA,+BAVF,EAWEA,4CAXF,CAHuBuB,CADlB,EAAA,OAkBEF,IAAAC,eAAAD,UAAgBE,KAAAA,CACvBvB,KADO,EAEPA,KAFO,EAGP,CACEA,YADF,EAEEA,mDAFF,EAGEA,yGAHF,EAIEA,uCAJF,EAKEA,mMALF,EAMEA,mCANF,EAOEA,0EAPF,EAQEA,wCARF,EASEA,+GATF,EAUEA,+CAVF,EAWEA,qCAXF,CAHuBuB,CAlBlB,EAAA,OAmCEF,IAAAC,eAAAD,UAAgBE,KAAAA,CACvBvB,WADO,EAEPA,KAFO,EAGP,CACEA,2BADF,EAEEA,oCAFF,EAGEA,2EAHF,EAIEA,SAJF,EAKEA,yCALF,EAMEA,SANF,EAOEA,uCAPF,EAQEA,SARF,EASEA,uCATF,EAUEA,+BAVF,EAWEA,8BAXF,CAHuBuB,CAnClB,EAAA,OAoDEF,IAAAC,eAAAD,UAAgBE,KAAAA,CACvBvB,aADO,EAEPA,KAFO,EAGP,CACEA,uCADF,EAEEA,uCAFF,EAGEA,uCAHF,EAIEA,mDAJF,EAKEA,sDALF,EAMEA,yEANF,CAHuBuB,CApDlB,EAAA,OAgEEF,IAAAC,eAAAD,UAAgBE,KAAAA,CACvBvB,UADO,EAEPA,KAFO,EAGP,CACEA,yBADF,EAEEA,kCAFF,EAGEA,gFAHF,EAIEA,yCAJF,EAKEA,6DALF,EAMEA,SANF,EAOEA,qDAPF,EAQEA,oDARF,EASEA,mDATF,EAUEA,gBAVF,EAWEA,4CAXF,CAHuBuB,CAhElB,EAAA,OAiFEF,IAAAC,eAAAD,UAAgBE,KAAAA,CACvBvB,UADO,EAEPA,KAFO,EAGP,CACEA,cADF,EAEEA,0HAFF,EAGEA,wEAHF,EAIEA,WAJF,EAKEA,uCALF,EAMEA,WANF,EAOEA,sDAPF,EAQEA,WARF,EASEA,sDATF,EAUEA,+BAVF,EAWEA,6CAXF,CAHuBuB,CAjFlB,EAAA,OAkGEF,IAAAC,eAAAD,UAAgBE,KAAAA,CACvBvB,WADO,EAEPA,KAFO,EAGP,CACEA,cADF,EAEEA,kDAFF,EAGEA,uGAHF,EAIEA,WAJF,EAKEA,oFALF,EAMEA,WANF,EAOEA,sDAPF,EAQEA,WARF,EASEA,sDATF,EAUEA,+BAVF,EAWEA,6CAXF,CAHuBuB,CAlGlB,EAmHRC,QAAAA,CAAAA,CAnHD;QAqHAxB,OAAAI,IAAAqB,iBAAAA,CAAgBnB,YAAMoB,MAAAA,CAAAA,CAAtBD;MA1JFzB,GAAAA,WAAAA,EAAuB2B,UAAvB3B;IADFD,GAAAA,WAAAA;EADFD,GAAAA,WAAAA;AAFAD;"}}]}